# Лабораторная работа № 5

## Задание
**Цель задания**
Разработать веб-приложение на языке Python с использованием фреймворка Flask, реализующее архитектуру MVC (Model-View-Controller). Приложение должно получать курсы указанных валют с сайта Центробанка РФ и отображать их пользователю. В реализации необходимо использовать объектно-ориентированный подход, шаблонизатор Jinja2 и SQLite3 для хранения данных.

**Требования к функционалу**

***1. Компонент Model:***
* Принимает список кодов валют (например, ['USD', 'EUR', 'GBP']);
* Отправляет запрос к сайту Центробанка РФ и получает данные о курсах;

* Реализует геттер для получения текущих отслеживаемых валют и их курсов;

* Реализует сеттер для изменения списка отслеживаемых валют;

* Реализован по паттерну проектирования Singleton (Одиночка) — в приложении может существовать только один экземпляр CurrencyRates.

* Для работы с данными и базой данных используется ORM (например, SQLAlchemy или Django ORM).  

***2. Компонент View:***

* Использует шаблонизатор Jinja2 для отображения данных.

* Позволяет пользователю просматривать курсы валют в удобном формате.

***3. Компонент Controller:***

* Получают список валют от пользователя;
* Обновляют список валют в модели;

* Сохраняют данные о курсах валют в базу данных SQLite3;

* Извлекают актуальные данные и передают их в шаблон для отображения.

**Дополнительные требования**
* Код должен быть структурирован по принципам MVC;

* Данные должны загружаться с официального API или XML-файла Центробанка России.

* Предусмотреть обработку ошибок (например, недопустимый код валюты, недоступность сайта ЦБ);

* Для взаимодействия с API можно использовать библиотеку requests.

* Использование библиотек sqlite3 для работы с базой данных и jinja2 для шаблонов.

* Приложение должно быть запущено через Flask (flask run).

**Этапы выполнения**
1. Реализовать класс CurrencyRates (паттерн "Одиночка").

2. Реализовать контроллер для обработки запросов и сохранения данных в SQLite3.

3. Разработать шаблоны на Jinja2 для отображения информации.

4. Написать код для интеграции всех компонентов в MVC-структуре.

5. Протестировать приложение, проверив работу с разными валютами.

**Критерии оценки**
* Корректная работа паттерна "Одиночка".

* Грамотная реализация модели, представления и контроллера.

* Работа с API Центробанка и корректное извлечение данных.

* Корректное сохранение данных в SQLite3 с помощью ORM.

* Использование Jinja2 или альтернативного способа формирования View.

* Читабельность и структурированность кода.

Базовый борд с фрагментами приложения: [https://gist.github.com/nzhukov/e55b26d29d8e6422b6e15a51479ec84e](https://gist.github.com/nzhukov/e55b26d29d8e6422b6e15a51479ec84e)



**Примерная структура проекта на Flask:**
```
currency_app/

├── app.py               # Главный файл Flask-приложения

├── model.py             # Класс CurrencyRates

├── controller.py        # Логика обработки маршрутов

├── templates/           # Шаблоны Jinja2

│   ├── index.html

│   └── update.html

├── static/              # Статические файлы (если нужно)

├── database.db          # SQLite база данных

└── requirements.txt     # Список зависимостей
```

---
## Результат

![image](https://github.com/jamanuriyeva/programming-4-sem/blob/bc00ff4dba1904c9703c059a90a2ca54e2100d03/LR5/pics/1.png)
![image](https://github.com/jamanuriyeva/programming-4-sem/blob/bc00ff4dba1904c9703c059a90a2ca54e2100d03/LR5/pics/2.png)
![image](https://github.com/jamanuriyeva/programming-4-sem/blob/bc00ff4dba1904c9703c059a90a2ca54e2100d03/LR5/pics/console.png)



## Решение

* Для работы с данными и базой данных используется ORM (SQLAlchemy)

* 1. Паттерн Singleton

 Предотвращает конфликты при многократных вызовах API

* 2. Разделение моделей
 
 CurrencyRate - только структура таблицы
 
 CurrencyRatesCRUD - только операции с БД

* 3. Двойное кэширование
  
Данные хранятся:

- В оперативной памяти (self._rates)
  
- В SQLite БД (для сохранности между запусками)

# 4. Гибкое управление валютами

 Можно динамически менять список отслеживаемых валют
 
 через property char_codes с автоматическим обновлением
